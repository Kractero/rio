<html>
  <head>
    <title>Advanced Card Queries</title>
    <link rel="stylesheet" href="css/pico.min.css" />
    <style>
      body {
        padding: 1rem;
      }
      #error {
        color: red;
      }
    </style>
  </head>
  <body>
    <h1>Advanced Card Queries</h1>
    <form id="card-query-form" action="result.html" method="GET" onsubmit="return validateForm()">
      <h3>Query:</h3>
      <p><textarea name="query" rows="10" cols="80"></textarea></p>
      <p>
        <strong>Season:</strong> <input type="radio" class="season" name="season" value="3" checked /> season 3
        <input type="radio" class="season" name="season" value="2" /> season 2
        <input type="radio" class="season" name="season" value="1" /> season 1
      </p>
      <p>
        <strong>User agent (required for ask, auction, bid, deck):</strong>
        <input type="text" class="useragent" name="useragent" />
      </p>
      <p id="error"></p>
      <p>
        <button name="submit" value="submit" type="submit">Submit</button>
        <button name="reset" value="reset" type="reset">Reset fields</button>
      </p>
    </form>
    <div id="instructions">
      <h3>Instructions:</h3>
      <ul>
        <li>Enter your card query, using the instructions described below.</li>
        <li>Select the season you want to search cards from.</li>
        <li>Click "Submit" to get the list of card IDs and corresponding links.</li>
      </ul>
      <h3>Query syntax:</h3>
      <p>Create a query by combining options from below, using parentheses and the following logical operations."</p>
      <ul>
        <li><strong>|</strong> - Logical OR.</li>
        <li><strong>&</strong> - Logical AND.</li>
        <li><strong>!</strong> - Logical NOT.</li>
      </ul>
      <h3>Query examples (see below for available options):</h3>
      <p>
        <strong>Example 1.</strong> To get all the cards of region The North Pacific, with rarity legendary or epic, use
        the query:"
      </p>
      <div><textarea cols="80" rows="2">region:the_north_pacific & (rarity:epic | rarity:legendary)</textarea></div>
      <p>
        <strong>Example 2.</strong> To get all the cards of region The North Pacific with rarity legendary, or all cards
        with rarity epic not in region Europeia, use the query:"
      </p>
      <div>
        <textarea cols="80" rows="2">
  (region:the_north_pacific & rarity:legendary) | (rarity:epic & !region:europeia)</textarea
        >
      </div>
      <h3>Available options:</h3>
      <p>You can use the following options to create a query.</p>
      <ul>
        <li><strong>ask:ASK</strong> - Cards that nation ASK has asks on.</li>
        <li><strong>auction</strong> - Cards for which there is currently an active auction.</li>
        <li><strong>badge:BADGE(:NUMBER)</strong> - Cards with the badge BADGE (and optionally number NUMBER).</li>
        <li><strong>bid:BID</strong> - Cards that nation BID has bids on.</li>
        <li>
          <strong>category:CATEGORY</strong> - Cards of nation category CATEGORY. (See the
          <a href="https://www.nationstates.net/page=faq#politics">NS FAQ</a> for a full list.)
        </li>
        <li><strong>collection:COLLECTION</strong> - Cards in the collection with ID COLLECTION.</li>
        <li><strong>cte</strong> - Cards of nations that have ceased to exist (CTE).</li>
        <li><strong>deck:DECK</strong> - Cards in the deck of nation DECK.</li>
        <li><strong>exnation</strong> - Cards marked as ex-nations.</li>
        <li><strong>flag:FLAG</strong> - Cards with flags containing the string FLAG.</li>
        <li><strong>motto:MOTTO</strong> - Cards with mottoes containing the string MOTTO.</li>
        <li><strong>name:NAME</strong> - Cards with names containing the string NAME.</li>
        <li><strong>pretitle:PRETITLE</strong> - Cards with pretitles containing the string PRETITLE.</li>
        <li><strong>rank:RANK</strong> - Cards that have a trophy of rank RANK.</li>
        <li><strong>rarity:RARITY</strong> - Cards of rarity RARITY.</li>
        <li><strong>region:REGION</strong> - Cards of region REGION.</li>
        <li>
          <strong>trophy:TROPHY(:RANK)</strong> - Cards that have a trophy of type TROPHY (and optionally rank RANK).
        </li>
      </ul>
    </div>

    <script>
      function validateUserAgent() {
        const form = document.getElementById('card-query-form')
        const formData = new FormData(form)
        const formObject = Object.fromEntries(formData.entries())

        const clientSide = formObject.query
          .split('\n')
          .filter(query => ['ask', 'auction', 'bid', 'collection', 'deck'].some(word => query.includes(word)))

        const errorElement = document.querySelector('#error')
        errorElement.textContent = ''

        if (clientSide.length > 0 && !formObject.useragent) {
          errorElement.textContent = 'Please provide a user agent for this query.'
          return false
        }

        return true
      }
    </script>
  </body>
</html>
